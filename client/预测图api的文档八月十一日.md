# `/newpredict` 接口文档

## 描述

该接口用于预测并返回用户的视力状况和未来的可能情况，包括屈光度、年龄、分位数和相关的参考曲线。预测曲线会生成一个平滑曲线以适应最新记录和原始记录，同时次要适应未来的记录。

## 请求方法

- **POST**

## 请求路径

- `/newpredict`

## 输入

### 请求

- **user_info**: 用户的基本信息
  - **name**: 用户姓名
  - **gender**: 性别 (`'male'` 或 `'female'`)
  - **birthday**: 出生日期 (`'YYYY-MM-DD'` 格式)
- **all_records**: 包含用户的所有检查记录的列表
  - **inspect_date**: 检查日期 (`'YYYY-MM-DDTHH:MM:SS'` 格式)
  - **diopter_s**: 球镜屈光度（可选）
  - **diopter_c**: 柱镜屈光度（可选）
  - **diopter_s_accurate**: 精确的球镜屈光度（可选）
  - **diopter_c_accurate**: 精确的柱镜屈光度（可选）
  - **AL**: 眼轴长度（可选）
  - **CR**: 角膜曲率半径（可选）

## 输出

### 响应体 (JSON 格式)

- **original_records**: 包含所有原始记录的列表，每个记录包含以下字段：
  - **age**: 记录时的年龄（以年为单位）
  - **data_level**: 数据级别（0，1，2，3）
  - **SE**: 等效球镜屈光度（计算值）
  - **DS**: 球镜屈光度
- **future_records**: 包含未来预测记录的列表，每个记录包含以下字段：
  - **diopter_s**: 预测的球镜屈光度
  - **age**: 预测时的年龄
  - **centile**: 预测时的分位数
- **warning_level**: 警告级别 (0 到 4，0 表示正常，4 表示超高度近视)
- **nearsight_level**: 近视级别 (0 到 4，0 表示正常，4 表示超高度近视)
- **situation_description**: 对整体情况的描述
- **reference_curves**: 参考曲线，包括`p5`、`p50`和`p95`的年龄和对应的屈光度值
- **smoothed_curve**: 平滑曲线，包含两个字段：
  - **age**: 100 个年龄点的列表
  - **values**: 对应的平滑屈光度值列表

### 绘图解释

原始记录散点 original_records
未来预测散点 future_records
三条背景线 reference_curves
一条预测线 smoothed_curve

## 示例

### 请求示例

curl -X POST "https://vpac-chart.cqwangkuai.com/newpredict" \
-H "Content-Type: application/json" \
-d '{
"user_info": {
"name": "欣欣",
"gender": 2,
"birthday": "2012-07-11"
},
"all_records": [
{
"inspect_date": "2022-01-01T12:00:00",
"AL": 1.23,
"CR": 4.56,
"K1": 7.89,
"K2": 0.12,
"diopter_s": -1.0,
"diopter_c": -0.5,
"diopter_s_accurate": -0.75,
"diopter_c_accurate": -0.25
},
{
"inspect_date": "2022-01-02T12:00:00",
"AL": 2.34,
"CR": 5.67,
"K1": 8.90,
"K2": 1.23,
"diopter_s": -1.0,
"diopter_c": -0.5,
"diopter_s_accurate": -0.75,
"diopter_c_accurate": -0.25
},
{
"inspect_date": "2022-01-03T12:00:00",
"AL": 3.45,
"CR": 6.78,
"K1": 9.01,
"K2": 2.34,
"diopter_s": -1.0,
"diopter_c": -0.5,
"diopter_s_accurate": -0.75,
"diopter_c_accurate": -0.25
}
]
}'

### 响应示例

```json
{
  "future_records": [
    {
      "age": 9,
      "centile": null,
      "diopter_s": -0.75
    },
    {
      "age": 10,
      "centile": null,
      "diopter_s": -1.0
    },
    {
      "age": 11,
      "centile": null,
      "diopter_s": -1.5
    },
    {
      "age": 12,
      "centile": null,
      "diopter_s": -2.0
    },
    {
      "age": 13,
      "centile": null,
      "diopter_s": -2.75
    },
    {
      "age": 14,
      "centile": null,
      "diopter_s": -3.25
    },
    {
      "age": 15,
      "centile": null,
      "diopter_s": -3.25
    },
    {
      "age": 16,
      "centile": null,
      "diopter_s": -3.75
    },
    {
      "age": 17,
      "centile": null,
      "diopter_s": -4.25
    }
  ],
  "nearsight_level": 0,
  "original_records": [
    {
      "AL": 1.23,
      "CR": 4.56,
      "DS": -0.75,
      "K1": 7.89,
      "K2": 0.12,
      "SE": -0.5,
      "age": 9.475701574264203,
      "data_level": 3,
      "diopter_c": -0.5,
      "diopter_c_accurate": -0.25,
      "diopter_s": -1.0,
      "diopter_s_accurate": -0.75,
      "inspect_date": "2022-01-01T12:00:00"
    },
    {
      "AL": 2.34,
      "CR": 5.67,
      "DS": -0.75,
      "K1": 8.9,
      "K2": 1.23,
      "SE": -0.5,
      "age": 9.478439425051334,
      "data_level": 3,
      "diopter_c": -0.5,
      "diopter_c_accurate": -0.25,
      "diopter_s": -1.0,
      "diopter_s_accurate": -0.75,
      "inspect_date": "2022-01-02T12:00:00"
    },
    {
      "AL": 3.45,
      "CR": 6.78,
      "DS": -0.75,
      "K1": 9.01,
      "K2": 2.34,
      "SE": -0.5,
      "age": 9.481177275838467,
      "data_level": 3,
      "diopter_c": -0.5,
      "diopter_c_accurate": -0.25,
      "diopter_s": -1.0,
      "diopter_s_accurate": -0.75,
      "inspect_date": "2022-01-03T12:00:00"
    }
  ],
  "reference_curves": {
    "p5": {
      "age": [
        2.3709787816564, 2.57493483776851, 2.77889089388063, 2.98284694999274,
        3.18680300610485, 3.39075906221697, 3.59471511832908, 3.7986711744412,
        4.00262723055331, 4.20658328666542, 4.41053934277754, 4.61449539888965,
        4.81845145500176, 5.02240751111388, 5.22636356722599, 5.4303196233381,
        5.63427567945022, 5.83823173556233, 6.04218779167445, 6.24614384778656,
        6.45009990389867, 6.65405596001079, 6.8580120161229, 7.06196807223501,
        7.26592412834713, 7.46988018445924, 7.67383624057136, 7.87779229668347,
        8.08174835279558, 8.2857044089077, 8.48966046501981, 8.69361652113192,
        8.89757257724404, 9.10152863335615, 9.30548468946827, 9.50944074558038,
        9.71339680169249, 9.91735285780461, 10.1213089139167, 10.3252649700288,
        10.5292210261409, 10.7331770822531, 10.9371331383652, 11.1410891944773,
        11.3450452505894, 11.5490013067015, 11.7529573628136, 11.9569134189257,
        12.1608694750379, 12.36482553115, 12.5687815872621, 12.7727376433742,
        12.9766936994863, 13.1806497555984, 13.3846058117105, 13.5885618678227,
        13.7925179239348, 13.9964739800469, 14.200430036159, 14.4043860922711,
        14.6083421483832, 14.8122982044953, 15.0162542606074, 15.2202103167196,
        15.4241663728317, 15.6281224289438, 15.8320784850559, 16.036034541168,
        16.2399905972801, 16.4439466533922, 16.6479027095044, 16.8518587656165,
        17.0558148217286, 17.2597708778407, 17.4637269339528, 17.6676829900649,
        17.871639046177, 18.0755951022891, 18.2795511584013, 18.4835072145134,
        18.6874632706255, 18.8914193267376, 19.0953753828497, 19.2993314389618,
        19.5032874950739, 19.7072435511861, 19.9111996072982, 20.1151556634103,
        20.3191117195224, 20.5230677756345, 20.7270238317466, 20.9309798878587,
        21.1349359439709, 21.338892000083, 21.5428480561951, 21.7468041123072,
        21.9507601684193, 22.1547162245314, 22.3586722806435, 22.5626283367557
      ],
      "values": [
        -2.15335756395082, -2.16366884155023, -2.17086819702889,
        -2.17443347268387, -2.17409327835874, -2.16955183251514,
        -2.15987885976163, -2.14400351251705, -2.12093587391838,
        -2.08980728893697, -2.05003122475602, -2.00189091066094,
        -1.94606720767658, -1.88332106227206, -1.81439488790632,
        -1.74058536984998, -1.66720311222032, -1.60076102961579,
        -1.54730856819936, -1.51256434645999, -1.5012100630281,
        -1.51150918171491, -1.53898314643464, -1.57939947144359,
        -1.6288429663699, -1.68413610648787, -1.74564559676299,
        -1.81542978743749, -1.89534406807556, -1.98686742758866,
        -2.09071344179499, -2.20445662437778, -2.32404527614478,
        -2.44552824887654, -2.56508377152534, -2.67925454104809,
        -2.78764685058308, -2.89179119288333, -2.99309379637579,
        -3.09281013131808, -3.19202378842552, -3.29124087741316,
        -3.3906352432357, -3.49045240843651, -3.5910130098333,
        -3.69275304316615, -3.79696266188077, -3.90560208287246,
        -4.02057729957246, -4.14370413610407, -4.27660698263323,
        -4.41883524339726, -4.56798882786046, -4.72169268863668,
        -4.87770919141949, -5.03391921455354, -5.18730915032002,
        -5.33395530965836, -5.47022988072313, -5.59281815904335,
        -5.69871520748108, -5.78749300190386, -5.86176281911122,
        -5.92414507959345, -5.97710116834817, -6.02297461786975,
        -6.06435885161281, -6.1042522280175, -6.14557394783961,
        -6.19112492719232, -6.24354233738579, -6.30258198926775,
        -6.36340422629504, -6.42088668436779, -6.47007399571321,
        -6.50615672633553, -6.52616834563992, -6.53051309959405,
        -6.51988822102642, -6.49491648924009, -6.45617063633971,
        -6.40475701338026, -6.34304301823381, -6.27365103102089,
        -6.19933410980287, -6.12300010750338, -6.04684921820075,
        -5.97095570534456, -5.89501799813381, -5.81867855386611,
        -5.74151270027969, -5.66317476328212, -5.58370163846529,
        -5.50317493957182, -5.42164013393546, -5.33910537725611,
        -5.25561110136594, -5.17140211300326, -5.08676547166433,
        -5.0019838856835
      ]
    },
    "p50": {
      "age": [
        2.3709787816564, 2.57493483776851, 2.77889089388063, 2.98284694999274,
        3.18680300610485, 3.39075906221697, 3.59471511832908, 3.7986711744412,
        4.00262723055331, 4.20658328666542, 4.41053934277754, 4.61449539888965,
        4.81845145500176, 5.02240751111388, 5.22636356722599, 5.4303196233381,
        5.63427567945022, 5.83823173556233, 6.04218779167445, 6.24614384778656,
        6.45009990389867, 6.65405596001079, 6.8580120161229, 7.06196807223501,
        7.26592412834713, 7.46988018445924, 7.67383624057136, 7.87779229668347,
        8.08174835279558, 8.2857044089077, 8.48966046501981, 8.69361652113192,
        8.89757257724404, 9.10152863335615, 9.30548468946827, 9.50944074558038,
        9.71339680169249, 9.91735285780461, 10.1213089139167, 10.3252649700288,
        10.5292210261409, 10.7331770822531, 10.9371331383652, 11.1410891944773,
        11.3450452505894, 11.5490013067015, 11.7529573628136, 11.9569134189257,
        12.1608694750379, 12.36482553115, 12.5687815872621, 12.7727376433742,
        12.9766936994863, 13.1806497555984, 13.3846058117105, 13.5885618678227,
        13.7925179239348, 13.9964739800469, 14.200430036159, 14.4043860922711,
        14.6083421483832, 14.8122982044953, 15.0162542606074, 15.2202103167196,
        15.4241663728317, 15.6281224289438, 15.8320784850559, 16.036034541168,
        16.2399905972801, 16.4439466533922, 16.6479027095044, 16.8518587656165,
        17.0558148217286, 17.2597708778407, 17.4637269339528, 17.6676829900649,
        17.871639046177, 18.0755951022891, 18.2795511584013, 18.4835072145134,
        18.6874632706255, 18.8914193267376, 19.0953753828497, 19.2993314389618,
        19.5032874950739, 19.7072435511861, 19.9111996072982, 20.1151556634103,
        20.3191117195224, 20.5230677756345, 20.7270238317466, 20.9309798878587,
        21.1349359439709, 21.338892000083, 21.5428480561951, 21.7468041123072,
        21.9507601684193, 22.1547162245314, 22.3586722806435, 22.5626283367557
      ],
      "values": [
        0.246032283522615, 0.229810922399052, 0.21412345345434,
        0.199324536983761, 0.185549004444134, 0.172934120176953,
        0.161983827278378, 0.153298972820641, 0.147483321903728,
        0.14514176283337, 0.146829728789379, 0.152827951474457,
        0.163311488786762, 0.17844408865583, 0.198384081556361,
        0.222858071238377, 0.248793487924297, 0.271984537927299,
        0.288203240693605, 0.293218689571782, 0.283577324819316,
        0.26154793732163, 0.232002823058252, 0.199804346907882,
        0.169771924507327, 0.146027560242908, 0.126894212777314,
        0.107701870150619, 0.0837845933813561, 0.0505157083821661,
        0.0038692701894564, -0.0545056227749807, -0.119641903244002,
        -0.186610734624555, -0.250583728657977, -0.307161653847054,
        -0.35612779799686, -0.400041461927589, -0.441473061195325,
        -0.482958670898425, -0.526907115848573, -0.574260364797912,
        -0.62483757514913, -0.678426628291984, -0.73481378690115,
        -0.793858957926879, -0.856787147191637, -0.925987158964316,
        -1.00382109616911, -1.0925675185073, -1.19431094412601,
        -1.30895010456669, -1.43429058393899, -1.56809652478299,
        -1.70820005763057, -1.85244726448416, -1.99681703616265,
        -2.13529619735735, -2.26206707403138, -2.37158129413154,
        -2.45858222572662, -2.52186347819749, -2.56521998959143,
        -2.5925919689015, -2.6077881386059, -2.61454631113825,
        -2.61694818391381, -2.61962420512047, -2.62724281004241,
        -2.64445305197428, -2.67579398508325, -2.72148215836339,
        -2.77463814305961, -2.8278291262308, -2.87377809492359,
        -2.90536123653008, -2.9183172131636, -2.91371088236716,
        -2.89311901961674, -2.85804608037151, -2.80995272492065,
        -2.75102474549447, -2.68512121020007, -2.61640927602203,
        -2.54916915723162, -2.48779311746087, -2.43520204272181,
        -2.39038054285891, -2.35165425761407, -2.3173085505907,
        -2.28559716235948, -2.25504408953585, -2.22500550112533,
        -2.19498648055286, -2.16448566316292, -2.13299521976794,
        -2.10014295651861, -2.06602051817874, -2.03082131342872,
        -1.99474083753783
      ]
    },
    "p95": {
      "age": [
        2.3709787816564, 2.57493483776851, 2.77889089388063, 2.98284694999274,
        3.18680300610485, 3.39075906221697, 3.59471511832908, 3.7986711744412,
        4.00262723055331, 4.20658328666542, 4.41053934277754, 4.61449539888965,
        4.81845145500176, 5.02240751111388, 5.22636356722599, 5.4303196233381,
        5.63427567945022, 5.83823173556233, 6.04218779167445, 6.24614384778656,
        6.45009990389867, 6.65405596001079, 6.8580120161229, 7.06196807223501,
        7.26592412834713, 7.46988018445924, 7.67383624057136, 7.87779229668347,
        8.08174835279558, 8.2857044089077, 8.48966046501981, 8.69361652113192,
        8.89757257724404, 9.10152863335615, 9.30548468946827, 9.50944074558038,
        9.71339680169249, 9.91735285780461, 10.1213089139167, 10.3252649700288,
        10.5292210261409, 10.7331770822531, 10.9371331383652, 11.1410891944773,
        11.3450452505894, 11.5490013067015, 11.7529573628136, 11.9569134189257,
        12.1608694750379, 12.36482553115, 12.5687815872621, 12.7727376433742,
        12.9766936994863, 13.1806497555984, 13.3846058117105, 13.5885618678227,
        13.7925179239348, 13.9964739800469, 14.200430036159, 14.4043860922711,
        14.6083421483832, 14.8122982044953, 15.0162542606074, 15.2202103167196,
        15.4241663728317, 15.6281224289438, 15.8320784850559, 16.036034541168,
        16.2399905972801, 16.4439466533922, 16.6479027095044, 16.8518587656165,
        17.0558148217286, 17.2597708778407, 17.4637269339528, 17.6676829900649,
        17.871639046177, 18.0755951022891, 18.2795511584013, 18.4835072145134,
        18.6874632706255, 18.8914193267376, 19.0953753828497, 19.2993314389618,
        19.5032874950739, 19.7072435511861, 19.9111996072982, 20.1151556634103,
        20.3191117195224, 20.5230677756345, 20.7270238317466, 20.9309798878587,
        21.1349359439709, 21.338892000083, 21.5428480561951, 21.7468041123072,
        21.9507601684193, 22.1547162245314, 22.3586722806435, 22.5626283367557
      ],
      "values": [
        1.49608007385217, 1.49220748740716, 1.48891720075634, 1.48654350563426,
        1.4851939722829, 1.48495201936116, 1.48614762740048, 1.48915622841004,
        1.49433906421942, 1.50204345975645, 1.51257039741884, 1.52602661727027,
        1.54244962839255, 1.56187421664089, 1.58433647103782, 1.60954114811489,
        1.6350273991598, 1.65748253142421, 1.67360308099518, 1.68010856139099,
        1.67449377024491, 1.65978418058795, 1.64152830666864, 1.6252937655257,
        1.61665244057768, 1.62036159759765, 1.6337843235521, 1.65033202478356,
        1.66323488710335, 1.66556675801526, 1.65102934214333, 1.62110472236524,
        1.58199503559713, 1.54000392769664, 1.50144219216795, 1.47220785374043,
        1.45298063965187, 1.44091594716132, 1.43313548076043, 1.42678508221677,
        1.41914392137095, 1.40921793801535, 1.39734288807335, 1.38389144750756,
        1.36923745816037, 1.35366729854394, 1.33586435991516, 1.31312058644004,
        1.28271498368272, 1.24197488411422, 1.18838928422085, 1.12170526782791,
        1.04383456256737, 0.956692096741323, 0.86207682930306, 0.76174726736104,
        0.660047187109877, 0.564206095465984, 0.481369024997333,
        0.418478343957354, 0.38222630796874, 0.37403130223746, 0.38858042980749,
        0.420155929857639, 0.463011930069499, 0.511327109552607,
        0.559220242140437, 0.600827088233919, 0.630315898557813,
        0.641914981514246, 0.630039011540443, 0.594806002619011,
        0.545714193781457, 0.493098283290866, 0.447167186875154,
        0.417974982778874, 0.411447505885462, 0.425746338735108,
        0.458240125259142, 0.506356597434703, 0.567548714721315,
        0.638415759530114, 0.713625220809595, 0.787492476731547,
        0.854222883455646, 0.907936453186354, 0.944926584356594,
        0.967114571571177, 0.977357997214025, 0.978555537509504,
        0.97362078375293, 0.965042282385753, 0.954089821485127,
        0.941797727334956, 0.929184737085727, 0.917252214551116,
        0.906772124691248, 0.897808254942953, 0.890267166983794,
        0.88404806285801
      ]
    }
  },
  "situation_description": "Normal vision.",
  "smoothed_curve": {
    "age": [
      9.0, 9.080808080808081, 9.16161616161616, 9.242424242424242,
      9.323232323232324, 9.404040404040405, 9.484848484848484,
      9.565656565656566, 9.646464646464647, 9.727272727272727,
      9.808080808080808, 9.88888888888889, 9.969696969696969, 10.05050505050505,
      10.131313131313131, 10.212121212121213, 10.292929292929292,
      10.373737373737374, 10.454545454545455, 10.535353535353536,
      10.616161616161616, 10.696969696969697, 10.777777777777779,
      10.858585858585858, 10.93939393939394, 11.02020202020202,
      11.1010101010101, 11.181818181818182, 11.262626262626263,
      11.343434343434343, 11.424242424242424, 11.505050505050505,
      11.585858585858587, 11.666666666666668, 11.747474747474747,
      11.828282828282829, 11.90909090909091, 11.98989898989899,
      12.070707070707071, 12.151515151515152, 12.232323232323232,
      12.313131313131313, 12.393939393939394, 12.474747474747474,
      12.555555555555555, 12.636363636363637, 12.717171717171718,
      12.7979797979798, 12.878787878787879, 12.95959595959596,
      13.040404040404042, 13.121212121212121, 13.202020202020202,
      13.282828282828284, 13.363636363636363, 13.444444444444445,
      13.525252525252526, 13.606060606060606, 13.686868686868687,
      13.767676767676768, 13.848484848484848, 13.92929292929293,
      14.01010101010101, 14.090909090909092, 14.171717171717173,
      14.252525252525253, 14.333333333333334, 14.414141414141415,
      14.494949494949495, 14.575757575757576, 14.656565656565657,
      14.737373737373737, 14.818181818181818, 14.8989898989899,
      14.97979797979798, 15.060606060606062, 15.141414141414142,
      15.222222222222221, 15.303030303030305, 15.383838383838384,
      15.464646464646465, 15.545454545454547, 15.626262626262626,
      15.707070707070708, 15.787878787878789, 15.868686868686869,
      15.94949494949495, 16.03030303030303, 16.11111111111111,
      16.191919191919194, 16.272727272727273, 16.353535353535353,
      16.434343434343436, 16.515151515151516, 16.5959595959596,
      16.67676767676768, 16.757575757575758, 16.83838383838384,
      16.91919191919192, 17.0
    ],
    "values": [
      -0.75, -0.7420265103263721, -0.7398939213919165, -0.7416127114900567,
      -0.7451933589142175, -0.7486463419578232, -0.750029334182534,
      -0.7602847225535198, -0.7864999046590264, -0.8251190534610564,
      -0.8725863419216149, -0.9253459430027047, -0.9798420296663282,
      -1.0326740874591565, -1.0825501255772803, -1.1296977315451602,
      -1.1743780404055444, -1.2168521872011835, -1.2573813069748252,
      -1.2962265347692188, -1.333649005627112, -1.3699098545912556,
      -1.4052702167043973, -1.4399912270092854, -1.4743340205486701,
      -1.5085596329087856, -1.5429170654376376, -1.5776319472023808,
      -1.6129272219442805, -1.6490258334046042, -1.686150725324619,
      -1.7245248414455923, -1.7643711255087897, -1.8059125212554799,
      -1.849371972426927, -1.8949724227644014, -1.9429368160091678,
      -1.9934880959024932, -2.0467839619189725, -2.1026011098418067,
      -2.160578328476533, -2.220354216412172, -2.2815673722377405,
      -2.3438563945422555, -2.4068598819147367, -2.4702164329442016,
      -2.5335646462196673, -2.5965431203301517, -2.658790453864672,
      -2.719945245412249, -2.7796461153560643, -2.837532185345123,
      -2.8932430782942533, -2.9464184389124455, -2.9966979119086905,
      -3.043721141991984, -3.087127773871315, -3.1265574522556765,
      -3.161649821854062, -3.1920445273754616, -3.2173812135288684,
      -3.2372995250232757, -3.251439553074596, -3.259765106418332,
      -3.2631343471578784, -3.262558589271414, -3.259049146737119,
      -3.2536173335331715, -3.2472744636377504, -3.2410318510290352,
      -3.235900809685205, -3.2328926535844382, -3.2330186967049133,
      -3.2372902530248107, -3.246718636522307, -3.26220757037939,
      -3.283724339366715, -3.3107540620942175, -3.3427778723275283,
      -3.3792769038322756, -3.4197322903740925, -3.463625165718608,
      -3.5104366636314523, -3.5596479178782565, -3.6107400622246506,
      -3.663194230436264, -3.7164915562787293, -3.770113173517676,
      -3.8235402159187317, -3.8762538172475325, -3.927735111269702,
      -3.977465231750876, -4.024925312456683, -4.069596487152752,
      -4.110959889604717, -4.148496653578204, -4.181687912838845,
      -4.210014801152272, -4.232958452284112, -4.25
    ]
  },
  "warning_level": 0
}
```
